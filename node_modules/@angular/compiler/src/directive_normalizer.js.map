{"version":3,"file":"directive_normalizer.js","sourceRoot":"","sources":["../../../../modules/@angular/compiler/src/directive_normalizer.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nimport {ViewEncapsulation} from '@angular/core';\n\nimport {CompileAnimationEntryMetadata, CompileDirectiveMetadata, CompileStylesheetMetadata, CompileTemplateMetadata} from './compile_metadata';\nimport {CompilerConfig} from './config';\nimport {isBlank, isPresent, stringify} from './facade/lang';\nimport {CompilerInjectable} from './injectable';\nimport * as html from './ml_parser/ast';\nimport {HtmlParser} from './ml_parser/html_parser';\nimport {InterpolationConfig} from './ml_parser/interpolation_config';\nimport {ResourceLoader} from './resource_loader';\nimport {extractStyleUrls, isStyleUrlResolvable} from './style_url_resolver';\nimport {PreparsedElementType, preparseElement} from './template_parser/template_preparser';\nimport {UrlResolver} from './url_resolver';\nimport {SyncAsyncResult, SyntaxError} from './util';\n\nexport interface PrenormalizedTemplateMetadata {\n  componentType: any;\n  moduleUrl: string;\n  template?: string;\n  templateUrl?: string;\n  styles?: string[];\n  styleUrls?: string[];\n  interpolation?: [string, string];\n  encapsulation?: ViewEncapsulation;\n  animations?: CompileAnimationEntryMetadata[];\n}\n@CompilerInjectable()\nexport class DirectiveNormalizer {\nprivate _resourceLoaderCache = new Map<string, Promise<string>>();\n/**\n * @param {?} _resourceLoader\n * @param {?} _urlResolver\n * @param {?} _htmlParser\n * @param {?} _config\n */\nconstructor(\nprivate _resourceLoader: ResourceLoader,\nprivate _urlResolver: UrlResolver,\nprivate _htmlParser: HtmlParser,\nprivate _config: CompilerConfig) {}\n/**\n * @return {?}\n */\nclearCache() { this._resourceLoaderCache.clear(); }\n/**\n * @param {?} normalizedDirective\n * @return {?}\n */\nclearCacheFor(normalizedDirective: CompileDirectiveMetadata) {\n    if (!normalizedDirective.isComponent) {\n      return;\n    }\n    this._resourceLoaderCache.delete(normalizedDirective.template.templateUrl);\n    normalizedDirective.template.externalStylesheets.forEach(\n        (stylesheet) => { this._resourceLoaderCache.delete(stylesheet.moduleUrl); });\n  }\n/**\n * @param {?} url\n * @return {?}\n */\nprivate _fetch(url: string): Promise<string> {\n    let /** @type {?} */ result = this._resourceLoaderCache.get(url);\n    if (!result) {\n      result = this._resourceLoader.get(url);\n      this._resourceLoaderCache.set(url, result);\n    }\n    return result;\n  }\n/**\n * @param {?} prenormData\n * @return {?}\n */\nnormalizeTemplate(prenormData: PrenormalizedTemplateMetadata):\n      SyncAsyncResult<CompileTemplateMetadata> {\n    let /** @type {?} */ normalizedTemplateSync: CompileTemplateMetadata = null;\n    let /** @type {?} */ normalizedTemplateAsync: Promise<CompileTemplateMetadata>;\n    if (isPresent(prenormData.template)) {\n      normalizedTemplateSync = this.normalizeTemplateSync(prenormData);\n      normalizedTemplateAsync = Promise.resolve(normalizedTemplateSync);\n    } else if (prenormData.templateUrl) {\n      normalizedTemplateAsync = this.normalizeTemplateAsync(prenormData);\n    } else {\n      throw new SyntaxError(\n          `No template specified for component ${stringify(prenormData.componentType)}`);\n    }\n\n    if (normalizedTemplateSync && normalizedTemplateSync.styleUrls.length === 0) {\n      // sync case\n      return new SyncAsyncResult(normalizedTemplateSync);\n    } else {\n      // async case\n      return new SyncAsyncResult(\n          null, normalizedTemplateAsync.then(\n                    (normalizedTemplate) => this.normalizeExternalStylesheets(normalizedTemplate)));\n    }\n  }\n/**\n * @param {?} prenomData\n * @return {?}\n */\nnormalizeTemplateSync(prenomData: PrenormalizedTemplateMetadata): CompileTemplateMetadata {\n    return this.normalizeLoadedTemplate(prenomData, prenomData.template, prenomData.moduleUrl);\n  }\n/**\n * @param {?} prenomData\n * @return {?}\n */\nnormalizeTemplateAsync(prenomData: PrenormalizedTemplateMetadata):\n      Promise<CompileTemplateMetadata> {\n    const /** @type {?} */ templateUrl = this._urlResolver.resolve(prenomData.moduleUrl, prenomData.templateUrl);\n    return this._fetch(templateUrl)\n        .then((value) => this.normalizeLoadedTemplate(prenomData, value, templateUrl));\n  }\n/**\n * @param {?} prenomData\n * @param {?} template\n * @param {?} templateAbsUrl\n * @return {?}\n */\nnormalizeLoadedTemplate(\n      prenomData: PrenormalizedTemplateMetadata, template: string,\n      templateAbsUrl: string): CompileTemplateMetadata {\n    const /** @type {?} */ interpolationConfig = InterpolationConfig.fromArray(prenomData.interpolation);\n    const /** @type {?} */ rootNodesAndErrors = this._htmlParser.parse(\n        template, stringify(prenomData.componentType), true, interpolationConfig);\n    if (rootNodesAndErrors.errors.length > 0) {\n      const /** @type {?} */ errorString = rootNodesAndErrors.errors.join('\\n');\n      throw new SyntaxError(`Template parse errors:\\n${errorString}`);\n    }\n\n    const /** @type {?} */ templateMetadataStyles = this.normalizeStylesheet(new CompileStylesheetMetadata({\n      styles: prenomData.styles,\n      styleUrls: prenomData.styleUrls,\n      moduleUrl: prenomData.moduleUrl\n    }));\n\n    const /** @type {?} */ visitor = new TemplatePreparseVisitor();\n    html.visitAll(visitor, rootNodesAndErrors.rootNodes);\n    const /** @type {?} */ templateStyles = this.normalizeStylesheet(new CompileStylesheetMetadata(\n        {styles: visitor.styles, styleUrls: visitor.styleUrls, moduleUrl: templateAbsUrl}));\n\n    let /** @type {?} */ encapsulation = prenomData.encapsulation;\n    if (isBlank(encapsulation)) {\n      encapsulation = this._config.defaultEncapsulation;\n    }\n\n    const /** @type {?} */ styles = templateMetadataStyles.styles.concat(templateStyles.styles);\n    const /** @type {?} */ styleUrls = templateMetadataStyles.styleUrls.concat(templateStyles.styleUrls);\n\n    if (encapsulation === ViewEncapsulation.Emulated && styles.length === 0 &&\n        styleUrls.length === 0) {\n      encapsulation = ViewEncapsulation.None;\n    }\n\n    return new CompileTemplateMetadata({\n      encapsulation,\n      template,\n      templateUrl: templateAbsUrl, styles, styleUrls,\n      ngContentSelectors: visitor.ngContentSelectors,\n      animations: prenomData.animations,\n      interpolation: prenomData.interpolation,\n    });\n  }\n/**\n * @param {?} templateMeta\n * @return {?}\n */\nnormalizeExternalStylesheets(templateMeta: CompileTemplateMetadata):\n      Promise<CompileTemplateMetadata> {\n    return this._loadMissingExternalStylesheets(templateMeta.styleUrls)\n        .then((externalStylesheets) => new CompileTemplateMetadata({\n                encapsulation: templateMeta.encapsulation,\n                template: templateMeta.template,\n                templateUrl: templateMeta.templateUrl,\n                styles: templateMeta.styles,\n                styleUrls: templateMeta.styleUrls,\n                externalStylesheets: externalStylesheets,\n                ngContentSelectors: templateMeta.ngContentSelectors,\n                animations: templateMeta.animations,\n                interpolation: templateMeta.interpolation\n              }));\n  }\n/**\n * @param {?} styleUrls\n * @param {?=} loadedStylesheets\n * @return {?}\n */\nprivate _loadMissingExternalStylesheets(\n      styleUrls: string[],\n      loadedStylesheets:\n          Map<string, CompileStylesheetMetadata> = new Map<string, CompileStylesheetMetadata>()):\n      Promise<CompileStylesheetMetadata[]> {\n    return Promise\n        .all(styleUrls.filter((styleUrl) => !loadedStylesheets.has(styleUrl))\n                 .map(styleUrl => this._fetch(styleUrl).then((loadedStyle) => {\n                   const /** @type {?} */ stylesheet = this.normalizeStylesheet(\n                       new CompileStylesheetMetadata({styles: [loadedStyle], moduleUrl: styleUrl}));\n                   loadedStylesheets.set(styleUrl, stylesheet);\n                   return this._loadMissingExternalStylesheets(\n                       stylesheet.styleUrls, loadedStylesheets);\n                 })))\n        .then((_) => Array.from(loadedStylesheets.values()));\n  }\n/**\n * @param {?} stylesheet\n * @return {?}\n */\nnormalizeStylesheet(stylesheet: CompileStylesheetMetadata): CompileStylesheetMetadata {\n    const /** @type {?} */ allStyleUrls = stylesheet.styleUrls.filter(isStyleUrlResolvable)\n                             .map(url => this._urlResolver.resolve(stylesheet.moduleUrl, url));\n\n    const /** @type {?} */ allStyles = stylesheet.styles.map(style => {\n      const /** @type {?} */ styleWithImports = extractStyleUrls(this._urlResolver, stylesheet.moduleUrl, style);\n      allStyleUrls.push(...styleWithImports.styleUrls);\n      return styleWithImports.style;\n    });\n\n    return new CompileStylesheetMetadata(\n        {styles: allStyles, styleUrls: allStyleUrls, moduleUrl: stylesheet.moduleUrl});\n  }\n}\n\nfunction DirectiveNormalizer_tsickle_Closure_declarations() {\n/** @type {?} */\nDirectiveNormalizer.prototype._resourceLoaderCache;\n/** @type {?} */\nDirectiveNormalizer.prototype._resourceLoader;\n/** @type {?} */\nDirectiveNormalizer.prototype._urlResolver;\n/** @type {?} */\nDirectiveNormalizer.prototype._htmlParser;\n/** @type {?} */\nDirectiveNormalizer.prototype._config;\n}\n\nclass TemplatePreparseVisitor implements html.Visitor {\n  ngContentSelectors: string[] = [];\n  styles: string[] = [];\n  styleUrls: string[] = [];\n  ngNonBindableStackCount: number = 0;\n/**\n * @param {?} ast\n * @param {?} context\n * @return {?}\n */\nvisitElement(ast: html.Element, context: any): any {\n    const /** @type {?} */ preparsedElement = preparseElement(ast);\n    switch (preparsedElement.type) {\n      case PreparsedElementType.NG_CONTENT:\n        if (this.ngNonBindableStackCount === 0) {\n          this.ngContentSelectors.push(preparsedElement.selectAttr);\n        }\n        break;\n      case PreparsedElementType.STYLE:\n        let /** @type {?} */ textContent = '';\n        ast.children.forEach(child => {\n          if (child instanceof html.Text) {\n            textContent += child.value;\n          }\n        });\n        this.styles.push(textContent);\n        break;\n      case PreparsedElementType.STYLESHEET:\n        this.styleUrls.push(preparsedElement.hrefAttr);\n        break;\n      default:\n        break;\n    }\n    if (preparsedElement.nonBindable) {\n      this.ngNonBindableStackCount++;\n    }\n    html.visitAll(this, ast.children);\n    if (preparsedElement.nonBindable) {\n      this.ngNonBindableStackCount--;\n    }\n    return null;\n  }\n/**\n * @param {?} ast\n * @param {?} context\n * @return {?}\n */\nvisitExpansion(ast: html.Expansion, context: any): any { html.visitAll(this, ast.cases); }\n/**\n * @param {?} ast\n * @param {?} context\n * @return {?}\n */\nvisitExpansionCase(ast: html.ExpansionCase, context: any): any {\n    html.visitAll(this, ast.expression);\n  }\n/**\n * @param {?} ast\n * @param {?} context\n * @return {?}\n */\nvisitComment(ast: html.Comment, context: any): any { return null; }\n/**\n * @param {?} ast\n * @param {?} context\n * @return {?}\n */\nvisitAttribute(ast: html.Attribute, context: any): any { return null; }\n/**\n * @param {?} ast\n * @param {?} context\n * @return {?}\n */\nvisitText(ast: html.Text, context: any): any { return null; }\n}\n\nfunction TemplatePreparseVisitor_tsickle_Closure_declarations() {\n/** @type {?} */\nTemplatePreparseVisitor.prototype.ngContentSelectors;\n/** @type {?} */\nTemplatePreparseVisitor.prototype.styles;\n/** @type {?} */\nTemplatePreparseVisitor.prototype.styleUrls;\n/** @type {?} */\nTemplatePreparseVisitor.prototype.ngNonBindableStackCount;\n}\n\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}